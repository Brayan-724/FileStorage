<!DOCTYPE html>
<html lang="en">
<head>
	<%- include("../../partials/header") %> 
	<title>Sign In - File Storage</title>
</head>
<body>
	<%- include("../../partials/nav") %> 

	<div class="container mt-5 mb-5">
		<div class="center">
			<div class="card w-200">
				<div class="card__header">
					Sign In
				</div>
				<div class="card__body">
					<form class="needs-validation" novalidate action="/signin?land=https://file-storage-0.herokuapp.com/p/{user}" method="post">
						<div class="inputs mb-4">
							<div>
								<label for="user" class="form-label">Username</label>
								<div class="input">
									<input type="username" required name="user" id="user" class="form-control">
									<div class="invalid-feedback">
										Write something
									</div>
								</div>
							</div>
							
							<div>
								<label for="password" class="form-label">
									<span>Password</span>
									<a href="#"> Forgot password?</a>
								</label>
								<input type="password" required name="password" id="password" class="form-control">
								<div class="invalid-feedback">
									Write something
								</div>
							</div>
						</div>
						
						<div class="buttons">
							<button type="submit" class="btn btn-primary w-100">Sign In</button>
						</div>
					</form>
				</div>
				<div class="card__footer">
					<span> Don't you have a acount? <a href="/join">Sign Up</a> </span>
				</div>
			</div>
		</div>
	</div>

	<script>
		function getValues(e) {
			/** @type {HTMLFormElement}  */
			const form = e;
			/** @type {HTMLInputElement} */
			const userElm = form.elements.user;
			/** @type {HTMLInputElement} */
			const passElm = form.elements.password;

			/** @type {HTMLDivElement} */
			const userErr = userElm.parentElement.querySelector("div.invalid-feedback");
			/** @type {HTMLDivElement} */
			const passErr = passElm.parentElement.querySelector("div.invalid-feedback");

			const username = userElm.value;
			const password = passElm.value;
			
			return {
				form,
				user: createErrorElement(userElm, userErr, form),
				pass: createErrorElement(passElm, passErr, form)
			};
		}

		/**
		 * @param {Event} e
		 */
		function onSubmit(e) {
			if(e.submitter === null) return stop(e);
			validate(e, getValues(e.target));
		}

		/**
		 * @param {Event} e
		 */
		function onInput(e) {
			validate(e, getValues(e.target.form));
		};

		/**
		 * @param {Event} e
		 */
		function validate(e, v) {
			{var _0x1e7e=['369191TuwoVz','test','1tbkNpM','user','493ESFHyf','constructor','416359hmzics','204062JouuuH','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','pass','294075hgQSJq','apply','223bptCOp','3197bWwzUS','6EjmtaG','value','2674oDWXmU','80163JgbXOv'];var _0x36f6=function(_0x3e9ab9,_0x12c170){_0x3e9ab9=_0x3e9ab9-0x172;var _0xb681c5=_0x1e7e[_0x3e9ab9];return _0xb681c5;};var _0x3291bd=_0x36f6;(function(_0x57c597,_0x4e1ff7){var _0x2330ed=_0x36f6;while(!![]){try{var _0x1ca376=parseInt(_0x2330ed(0x180))*-parseInt(_0x2330ed(0x182))+-parseInt(_0x2330ed(0x174))+-parseInt(_0x2330ed(0x17a))*-parseInt(_0x2330ed(0x17e))+-parseInt(_0x2330ed(0x178))+-parseInt(_0x2330ed(0x175))+-parseInt(_0x2330ed(0x17f))*parseInt(_0x2330ed(0x17c))+parseInt(_0x2330ed(0x172))*parseInt(_0x2330ed(0x17b));if(_0x1ca376===_0x4e1ff7)break;else _0x57c597['push'](_0x57c597['shift']());}catch(_0x41d9c1){_0x57c597['push'](_0x57c597['shift']());}}}(_0x1e7e,0x638ce));var _0x4d64d6=function(){var _0x327eb2=!![];return function(_0x26b4f6,_0x4d76a5){var _0x222d2f=_0x327eb2?function(){var _0x42b1d8=_0x36f6;if(_0x4d76a5){var _0x41844d=_0x4d76a5[_0x42b1d8(0x179)](_0x26b4f6,arguments);return _0x4d76a5=null,_0x41844d;}}:function(){};return _0x327eb2=![],_0x222d2f;};}(),_0x3367b7=_0x4d64d6(this,function(){var _0x21deba=function(){var _0x163e3c=_0x36f6,_0x43dcdb=_0x21deba['constructor']('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[_0x163e3c(0x173)](_0x163e3c(0x176));return!_0x43dcdb[_0x163e3c(0x181)](_0x3367b7);};return _0x21deba();});_0x3367b7(),repeat(_0x5ee094=>{var _0x3537e9=_0x36f6;Err('Only\x20use\x20[a-z,\x20A-Z,\x200-9,\x20_,\x20-]',_0x5ee094,regCheck(_0x5ee094[_0x3537e9(0x17d)],/([^a-zA-Z0-9_-])/))||Err('Don\x27t\x20leave\x20blank',_0x5ee094,regCheck(_0x5ee094[_0x3537e9(0x17d)],/^\s*$/))?stop(e):removeError(_0x5ee094);},v[_0x3291bd(0x183)],v[_0x3291bd(0x177)]);}

			{var _0x4aaf=['212851KMmmqk','3hOxJWU','139340vaxwix','9DAjxhZ','59cQLQvL','10259MovkuE','58251aNRKYF','user','10093WbErUP','67yBubRV','646740LNYbOy','4520rImGKi','14krrjGV','length'];var _0x1320=function(_0x349c87,_0x1e6c83){_0x349c87=_0x349c87-0x156;var _0x4aaf80=_0x4aaf[_0x349c87];return _0x4aaf80;};var _0x449213=_0x1320;(function(_0x5a3b5e,_0x41414e){var _0x1d276f=_0x1320;while(!![]){try{var _0x59bd10=-parseInt(_0x1d276f(0x15a))+parseInt(_0x1d276f(0x163))*parseInt(_0x1d276f(0x156))+parseInt(_0x1d276f(0x161))*-parseInt(_0x1d276f(0x15d))+parseInt(_0x1d276f(0x160))*parseInt(_0x1d276f(0x15c))+parseInt(_0x1d276f(0x15b))*parseInt(_0x1d276f(0x15e))+-parseInt(_0x1d276f(0x162))+parseInt(_0x1d276f(0x159))*parseInt(_0x1d276f(0x158));if(_0x59bd10===_0x41414e)break;else _0x5a3b5e['push'](_0x5a3b5e['shift']());}catch(_0x29d9e5){_0x5a3b5e['push'](_0x5a3b5e['shift']());}}}(_0x4aaf,0x54ff2),Err('Maximum\x2019\x20characters',v[_0x449213(0x15f)],v[_0x449213(0x15f)]['value'][_0x449213(0x157)]>0x13));}
		}

		//#region Helpers
		function stop(e) {
			e.preventDefault();
			return;
		}

		/**
		 * @param {(...args)=>void} callback
		 * @param {any[]} args
		 */
		function repeat(callback, ...args) {
			for(const arg of args) {
				callback(arg);
			}
		}

		/**
		 * @param {string} str
		 * @param {RegExp} reg
		 */
		function regCheck(str, reg) {
			return str.match(reg) != null;
		}
		
		/**
		 * @param {string} text
		 * @param {Document} err
		 * @param {boolean[]|boolean[][]} checks
		 */
		function Err(text, err, ...checks) {
			if(checkError.apply(checkError, checks)) {
				useError(text, err);
				return true;
			}
			return false;
		}

		/**
		 * @param {boolean[]|boolean[][]} checks
		 */
		function checkError(...checks) {
			let r = null;
			for(let check of checks) {
				if(typeof check === "boolean") {
					r = check || r;
				}

				if(Array.isArray(check)) {
					let rr = true;
					for(let ocheck of check) {
						rr = ocheck && rr;
						if(!rr) break;
					}
					r = rr || r;
				}
			}
			return r || false;
		}

		/**
		 * @param {string} text
		 * @param {Document} err
		 */
		function useError(text, err) {
			err.error = text;
            err.inp.classList.add("invalid");
		}

		/**
		 * @param {Document} err
		 */
		function removeError(err) {
			err.error = "";
			err.inp.classList.remove("invalid");
		}

		/**
		 * @param {HTMLInputElement} input
		 * @param {HTMLDivElement} errElm
		 * @param {HTMLFormElement} form
		 */
		function createErrorElement(input, errElm, form) {
			return {
				inp: input,
				err: errElm,
				form: form,
				get value() {return input.value},
				set value(v) {return input.value = v},
				get error() {return errElm.innerText},
				set error(v) {return errElm.innerHTML = v}
			}
		}
		//#endregion

		document.querySelector("form.needs-validation").addEventListener("submit", onSubmit);
		document.querySelector("form.needs-validation").addEventListener("input", onInput);
	</script>

	<%- include("../../partials/footer") %> 
	
</body>
</html>